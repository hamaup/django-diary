name: Django CI # ワークフローの名前 (GitHub Actions の画面に表示される)

on: # ワークフロー実行のトリガー (いつワークフローを実行するか)
  push: # push イベントが発生した場合
    branches: [ "main" ] # main ブランチに push された場合のみ実行
  pull_request: # pull_request イベントが発生した場合
    branches: [ "main" ] # main ブランチへの pull request が作成された場合のみ実行

jobs: # ジョブ (実行される処理のまとまり) を定義
  build: # ジョブの名前 (任意)
    runs-on: ubuntu-latest # ジョブを実行する OS (Ubuntu 最新版)

    steps: # ステップ (ジョブの中で実行される個々の処理) を定義
    - uses: actions/checkout@v3 # actions/checkout@v3 アクションを使って、リポジトリのコードをチェックアウト (取得)
    - name: Set up Python 3.10 # Python 3.9 をセットアップ
      uses: actions/setup-python@v3
      with:
        python-version: "3.10"

    - name: Install dependencies # 依存パッケージをインストール
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt # requirements.txt に記述されたパッケージをインストール

    - name: Run migrations
      run: python manage.py migrate
      # テスト実行前にマイグレーションを実施

    - name: Run tests # テストを実行
      run: python manage.py test # python manage.py test コマンドを実行
